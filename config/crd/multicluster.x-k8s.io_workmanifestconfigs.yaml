# Copyright 2021 The Kubernetes Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: workmanifestconfigs.multicluster.x-k8s.io
spec:
  group: multicluster.x-k8s.io
  scope: Cluster
  names:
    plural: workmanifestconfigs
    singular: workmanifestconfig
    kind: WorkManifestConfig
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      "schema":
        "openAPIV3Schema":
          description: WorkManifestConfig represents the configuration of a workload manifest. This resource allows the user to customize the configuration of a manifest inside a Work object. WorkManifestConfig is a cluster-scoped resource.
          type: object
          required:
            - spec
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: Spec defines the configuration for a workload manifest.
              type: object
              properties:
                manifestGVK:
                  description: ManifestGVK represents the type of manifest this configuration is for
                  type: object
                  required:
                    - group
                    - kind
                    - version
                  properties:
                    group:
                      description: Group is the group of the workload resource manifest.
                      type: string
                    kind:
                      description: Kind is the kind of the workload resource manifest.
                      type: string
                    version:
                      description: Version is the version of the workload resource manifest.
                      type: string
                resourceStatusSync:
                  description: ResourceStatusSyncConfiguration represents the configuration of workload manifest status sync.
                  type: object
                  properties:
                    frequencySeconds:
                      description: FrequencySeconds represents how often (in seconds) to perform the probe. Default to 60 seconds. Minimum value is 1.
                      type: integer
                      format: int32
                    rules:
                      description: StatusSyncRule defines what resource status field should be returned.
                      type: array
                      items:
                        description: StatusSyncRule represents a resource status field should be returned.
                        type: object
                        required:
                          - type
                        properties:
                          jsonPaths:
                            description: JsonPaths defines the json path under status field to be synced.
                            type: array
                            items:
                              description: JsonPath represents a status field to be synced for a manifest using json path.
                              type: object
                              required:
                                - name
                                - path
                              properties:
                                name:
                                  description: Name represents the alias name for this field
                                  type: string
                                path:
                                  description: Path represents the json path of the field under status. The path must point to a field with single value in the type of integer, bool or string. If the path points to a non-existing field, no value will be returned. If the path points to a structure, map or slice, no value will be returned and the status conddition of 'StatusSynced' will be set as false. Ref to https://kubernetes.io/docs/reference/kubectl/jsonpath/ on how to write a jsonPath.
                                  type: string
                                version:
                                  description: Version is the version of the Kubernetes resource. If it is not specified, the resource with the semantically latest version is used to resolve the path.
                                  type: string
                          scripts:
                            description: Scripts defines the script evaluation under status field to be synced.
                            type: array
                            items:
                              description: Script represents a status field to be synced for a manifest using a scripting language evaluation.
                              type: object
                              required:
                                - content
                                - language
                                - name
                              properties:
                                content:
                                  description: Content represents the script that will be evaluated against the workload resource status field.
                                  type: string
                                language:
                                  description: Language represents the language of the script.
                                  type: string
                                name:
                                  description: Name represents the alias name for this field
                                  type: string
                          type:
                            description: Type defines the option of how status can be returned. It can be JSONPaths or Scripts. If the type is JSONPaths, user should specify the jsonPaths field. If the type is Scripts, user should specify the scripts field.
                            type: string
                            enum:
                              - JSONPaths
                              - Scripts
                    stopThreshold:
                      description: StopSyncThreshold represents minimum consecutive probe before stopping the sync. Defaults to 0. Minimum value is 0. The value 0 represents never stop syncing.
                      type: integer
                      format: int32
